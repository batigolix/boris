/**
 * @file
 * Provides custom map configuration for digitisation industry europe map.
 * 
 * Serves as input for Webtools' load.js.
 */

// Provides the map data.
var data = {
  "AT": {
    "label": "Austria",
    "projects": {
      "0" : {
        "name": "Produktion der Zukunft (Production of the Future)",
        "url" : "http://www.ffg.at/produktion",
        "type": "national"
      }   
    }
  },
  "BE": {
    "label": "Belgium",
    "projects": {
      "0" : {
        "name": "MADE DIFFERENT – Factories of the future",
        "url": "http://www.madedifferent.be",
        "type": "national"
      },
      "1": {
        "name": "Marshall 4.0",
        "url": "http://www.wallonie.be/fr/plan-marshall",
         "type": "national"
      },  
      "2": {
        "name": "Flanders Make ",
        "url": "http://www.flandersmake.be",
        "type": "national"
      },
      "3": {
        "name": "iMinds",
        "url": "http://www.iminds.be",
        "type": "national"
      }
    }
  },
  "CZ": {
    "label": "Czech Republic",
    "projects": {
      "0": {
        "name": "Průmysl 4.0/ Industry 4.0",
        "url": "http://www.mpo.cz/dokument162351.html",
        "type": "national"
      }
    }
  },
  "DK": {
    "label": "Denmark",
    "projects": {
      "0": {
        "name": "MADE – Manufacturing Academy of Denmark",
        "url": "http://made.dk",
        "type": "national"
      }
    }
  },
  "FI": {
    "label": "Finland",
    "projects": {
      "0": {
        "name": "FIMECC PPP Programmes",
        "url": "http://www.fimecc.com/programs",
        "type": "national"
      },
      "1" : {
        "name": "DIGILE  (ICT Alliance with China)",
        "url": "http://digile.fi/fi",
        "type": "national"
      },
      "2": {
        "name": "TEKES – Industrial Internet",
        "url": "http://www.tekes.fi/en/programmes-and-services/tekes-programmes/industrial-internet--business-revolution",
        "type": "national"
      }
    }
  },
  "FR": {
    "label": "France",
    "projects": {
      "0": {
        "name": "Nouvelle France Industrielle",
        "url": "http://www.economie.gouv.fr/vous-orienter/industrie/nouvelle-france-industrielle",
        "type": "national"
      },
      "1": {
        "name": "Industrie du Futur",
        "url": "http://allianceindustrie.wix.com/industrie-dufutur",
        "type": "national"
      },
      "2": {
        "name": "Transition Numérique",
        "url": "http://transition-numerique.fr",
        "type": "national"
      },
      "3": {
        "name": "Le Programme des Investissements d’Avenir",
        "url": "http://www.agence-nationale-recherche.fr/investissements-d-avenir",
        "type": "national"
      },
      "4": {
        "name": "FoF Ile-de-France",
        "url": "http://www.pole-astech.org/site/pages/index.php?doi=859b53568eb0059f7e6cbda05d35a77d",
        "type": "national"
      }
    }
  },
  "DE": {
    "label": "Germany",
    "projects": {
      "0": {
        "name": "Plattform Industrie 4.0",
        "url": "http://www.plattform-i40.de",
        "type": "national"
      },
      "1": {
        "name": "Mittelstand 4.0",
        "url": "http://www.mittelstand-digital.de/DE/Foerderinitiativen/mittelstand-4-0.html",
        "type": "national"
      },
      "2": {
        "name": "Smart Service World ",
        "url": "http://industrie4.0.gtai.de/INDUSTRIE40/Navigation/EN/Topics/smart-service-world.html",
        "type": "national"
      },
      "3": {
        "name": "Autonomik for Industrie 4.0 - Production, Products, Services in the Internet of the Future",
        "url": "http://autonomik40.de",
        "type": "national"
      },
      "4": {
        "name": "It's OWL",
        "url": "http://www.its-owl.com/home",
        "type": "national"
      },
      "5": {
        "name": "Allianz Industrie 4.0 Baden-Würtemberg",
        "url": "http://www.i40-bw.de",
        "type": "national"
      }
    }
  },
  "EL": {
    "label": "Greece",
    "projects": {
      "0": {
        "name": "Regional Operational Programme of Region of Western Greece for the Period 2014-2020",
        "url": "http://dytikiellada.gr",
        "type": "national"
      }
    }
  },
  "IT": {
    "label": "Italy",
    "projects": {
      "0": {
        "name": "Internet of Things and Industry 4.0",
        "url": "",
        "type": "national"
      },
      "1": {
        "name": "Cluster Fabbrica Intelligente CFI (Intelligent Factories Cluster)",
        "url": "http://www.fabbricaintelligente.it/",
        "type": "national"
      },
      "2": {
        "name": "Cluster Fabbrica Intelligente Lombardia AFIL (Cluster Intelligent Factories Lombardy)",
        "url": "http://www.afil.it",
        "type": "national"
      }
    }
  },
  "LT": {
    "label": "Latvia",
    "projects": {
      "0": {
        "name": "Demola Latvia (Riga IT TechHub)",
        "url": "http://latvia.demola.net/about",
        "type": "national"
      }
    }
  },
  "NL": {
    "label": "Netherlands",
    "projects": {
      "0": {
        "name": "Smart Industry",
        "url": "http://www.smartindustry.nl",
        "type": "national"
      }
    }
  },
  "PL": {
    "label": "Poland",
    "projects": {
      "0": {
        "name": "INNOMED",
        "url": "http://www.ncbir.pl/programy-krajowe/programy-sektorowe/innomed",
        "type": "national"
      },
      "1": {
        "name": "INNOLOT",
        "url": "http://www.ncbir.pl/programy-krajowe/programy-sektorowe/innolot",
        "type": "national"
      },
      "2": {
        "name": "CuBR",
        "url": "http://www.ncbir.pl/en/news/art,3875,more-than-pln-100-million-in-3rd-competition-for-innovators-in-non-ferrous-metals-industry.html",
        "type": "national"
      },
      "3": {
        "name": "BIOSTRATEG",
        "url": "http://www.ncbr.gov.pl/programy-strategiczne/srodowisko-naturalne-rolnictwo-i-lesnictwo---biostrateg",
        "type": "national"
      }
    }
  },
  "PT": {
    "label": "Portugal",
    "projects": {
      "0": {
        "name": "PRODUTECH – Production Technologies Cluster",
        "url": "http://www.produtech.org",
        "type": "national"
      }
    }
  },
  "SK": {
    "label": "Slovakia",
    "projects": {
      "0": {
        "name": "Smart Industry",
        "url": "",
        "type": "national"
      }
    }
  },
  "ES": {
    "label": "Spain",
    "projects": {
      "0": {
        "name": "Industria Conectada 4.0",
        "url": "http://www.industriaconectada40.gob.es",
        "type": "national"
      },
      "1": {
        "name": "Basque Industry 4.0",
        "url": "http://www.spri.eus/industry40",
        "type": "national"
      }
    }
  },
  "SE": {
    "label": "Sweden",
    "projects": {
      "0": {
        "name": "Produktion 2030",
        "url": "http://www.produktion2030.se",
        "type": "national"
      }
    }
  },
  "UK": {
    "label": "United Kingdom",
    "projects": {
      "0": {
        "name": "High value Manufacturing Catapult",
        "url": "http://hvm.catapult.org.uk",
        "type": "national"
      },
      "1": {
        "name": "Innovate UK",
        "url": "http://www.gov.uk/government/organisations/innovate-uk",
        "type": "national"
      },
      "2": {
        "name": "EPSRC Manufacturing the Future theme",
        "url": "http://www.epsrc.ac.uk/research/ourportfolio/themes/manufacturingthefuture",
        "type": "national"
      },
      "3": {
        "name": "Action Plan for Manufacturing",
        "url": "http://www.scottish-enterprise.com/knowledge-hub/articles/insight/scotlands-manufacturing-action-plan",
        "type": "national"
      }
    }
  }
}



/* DATA STRUCTURE */
// var data = {
//   "CV": {
//     "name": {
//       "en": "Cape Verde"
//     },
//     "expiry": "22.12.2018",
//     "type": "tuna",
//     "total": "550 000 &euro; /<br />500 000 &euro;",
//     "earmark": "275 000 &euro; /<br />250 000 &euro;",
//     "link": "cape_verde"
//   },
//   "KM": {
//     "name": {
//       "en": "Comoros"
//     },
//     "expiry": "31.12.2016",    
//     "type": "tuna",    
//     "total": "600 000 &euro;",          
//     "earmark": "300 000 &euro;",
//     "link": "comoros"
//   },
//   "CI": {  
//     "name": {
//       "en": "Ivory Coast"
//     },
//     "expiry": "30.06.2018",    
//     "type": "tuna",    
//     "total" : "680 000 &euro;",          
//     "earmark": "257 500 &euro;",
//     "link": "cote_d_ivoire"
//   },
//   "GA": {
//     "name": {
//       "en": "Gabon"
//     },
//     "expiry": "27.07.2016",    
//     "type": "tuna",    
//     "total": "1 350 000 &euro;",        
//     "earmark": "450 000 &euro;",
//     "link": "gabon"
//   },
//   "GL": {
//     "name": {
//       "en": "Weenland"
//     },
//     "expiry": "31.12.2015",    
//     "type": "mixed",    
//     "total": "17 847 244 &euro;",
//     "earmark": "2 743 041 &euro;",
//     "link": "greenland"
//   },
//   "GW": {
//     "name": {
//       "en": "Guinea-Bissau"
//     },
//     "expiry": "23.11.2017",
//     "type": "mixed",
//     "total": "9 200 000 &euro;",
//     "earmark": "3 000 000 &euro;",
//     "link": "guinea_bissau"
//   },
//   "KI": {
//     "name": {
//       "en": "Kiribati"
//     },
//     "expiry": "15.09.2015",
//     "type": "tuna",
//     "total": "1 325 000 &euro;",
//     "earmark": "350 000 &euro;",
//     "link": "kiribati"
//   },
//   "LR": {
//     "name": {
//       "en": "Liberia"
//     },
//     "expiry": "5 years",
//     "type": "tuna",
//     "total": "715 000 &euro /<br />650 000 &euro /<br />585 000 &euro;",
//     "earmark": "357 500 &euro; /<br />352 000 /<br />292 500 &euro;",
//     "link": "liberia"
//   },
//   "MG": {
//     "name": {
//       "en": "Madagascar"
//     },
//     "expiry": "31.12.2018",
//     "type": "tuna",
//     "total": "1 566 250 &euro; /<br />1 487 500 &euro;",
//     "earmark": "700 000 &euro;",
//     "link": "madagascar"
//   },
//   "MR": {
//     "name": {
//       "en": "Mauritania"
//     },
//     "expiry": "4 years",
//     "type": "mixed",
//     "total": "59 125 000 &euro;",
//     "earmark": "4 125 000 &euro;",
//     "link": "mauritania"
//   },
//   "MU": {
//     "name": {
//       "en": "Mauritius"
//     },
//     "expiry": "27.01.2017",
//     "type": "tuna",
//     "total": "660 000 &euro;",
//     "earmark": "302 500 &euro;",
//     "link": "mauritius"
//   },
//   "FM": {
//     "name": {
//       "en": "Micronesia"
//     },
//     "additional": {
//       "en": "No protocol in force since 25.2.2010"
//     },
//     "link": "micronesia"
//   },
//   "MA": {
//     "name": {
//       "en": "Morocco"
//     },
//     "expiry": "27.02.2015",
//     "type": "mixed",
//     "total": "30 million &euro;",
//     "earmark": "14 million &euro;",
//     "link": "morocco"
//   },
//   "MZ": {
//     "name": {
//       "en": "Mozambique"
//     },
//     "additional": {
//       "en": "Protocol expired on 31 January 2015"
//     },
//     "link": "mozambique"
//   },
//   "ST": {
//     "name": {
//       "en": "Sao Tome and Principe"
//     },
//     "expiry": "22.05.2018",
//     "type": "tuna",
//     "total": "710 000 &euro /<br />675 000&euro;",
//     "earmark": "325 000 &euro;",
//     "link": "sao_tome"
//   },
//   "SN": {
//     "name": {
//       "en": "Senegal"
//     },
//     "expiry": "19.11.2019",
//     "type": "tuna",
//     "total": "1 808 000 &euro;/<br />1 668 000 &euro;",
//     "earmark": "750 000 &euro;",
//     "link": "senegal"
//   },
//   "SC": {
//     "name": {
//       "en": "Seychelles"
//     },
//     "expiry": "17.01.2020",
//     "type": "tuna",
//     "total": "5 350 000 &euro in 2014<br />to 5 000 000 in 2019",
//     "earmark": "2 600 000 &euro;",
//     "link": "seychelles"
//   },
//   "SB": {
//     "name": {
//       "en": "Solomon Islands"
//     },
//     "additional": {
//       "en": "No protocol in force since 09.10.2012"
//     },
//     "link": "solomon_islands"
//   },
//   "FO": {
//     "name": {
//       "en": "Faroe Islands"
//     },
//     "additional": {
//       "en": "Northern Agreement<br />Period 2006 - 2012"
//     },
//     "type": "northern",
//     "link": "faeroe_islands"
//   },
//   "NO": {
//     "name": {
//       "en": "Norway"
//     },
//     "additional": {
//       "en": "Northern Agreement<br />Period 2009 - 2015"
//     },
//     "type": "northern",
//     "link": "norway"
//   }
// };
// /* END DATA STRUCTURE */

/* TRANSLATIONS SET */
var trans = {
  "expiry": {
    "en": "Expiry date"
  },
  "type": {
    "en": "Type"
  },
  "total": {
    "en": "Total contribution from the EU budget per year"
  },
  "earmark": {
    "en": "Earmarked for fisheries policy development"
  },
  "tuna": {
    "en": "Tuna agreement"
  },
  "mixed": {
    "en": "Multi-species agreement"
  },
  "northern": {
    "en": "Northern"
  }
}

/* END TRANSLATIONS SET */

var curlang = document.lang;

function getTrans(key) {
  if ( trans[key][curlang] ) {
    return trans[key][curlang];
  } else if ( trans[key].en ) {
    return trans[key].en;
  } else {
    return key;
  }
}


L.custom = { 
  init: function(obj,params) {
    
    obj.style.minHeight = "330px";
    
    var map = L.map( obj, {
     "center" : [48,9],
      "zoom" : 4,
      "minZoom": 3,
      "maxZoom": 8,
      "dragging": true,
      "touchZoom": true,
      "scrollWheelZoom": true
    });
    
    var tileLayer = L.wt.tileLayer("graybg", {attribution: "European Commission, DG CONNECT, Unit A3"}).addTo(map);

    // Fetches country colours based on property.
    function getColor(CNTR_ID) {
      if ( data[CNTR_ID] && data[CNTR_ID].type ) {
        if ( data[CNTR_ID].type === "tuna" ) {
          return "#FFC7CE";
        } else if ( data[CNTR_ID].type === "mixed" ) {
          return "#C6EFCE";
        } else if ( data[CNTR_ID].type === "northern" ) {
          return "#FFEB9C";
        }
      }
      return "#C8E9F2";
    }
    
    // Defines country colours.
    var country_options = {
      label : true,
      style: function(feature){
        var opacity = 1;
        if (typeof feature.properties.type != "undefined") {
          opacity = 0.4;
        }
        return {
          fillColor: getColor(feature.properties.CNTR_ID),
          color: "#0065B1",
          dashArray: 0,
          fillOpacity: 0.9,
          opacity: 1,
          smoothFactor: 1.5,
          weight: 1        };
      },
      
      onEachFeature: function (feature, layer) {
        // console.log(feature);
        country = feature.properties.CNTR_ID;
        if ( data[country] ) {
        	console.log(data[country]);
          var info = "<h3>" + data[country].label + "</h3>";
          if ( data[country].projects ) {
            info += "<hr /><br />";
            var arrayLength = data[country].projects.length;

console.log(arrayLength);

            for (var i = 0; i < arrayLength; i++) {

            	console.log(i);

console.log(data[country]);
console.log(data[country].projects);
console.log(data[country].projects[i]);
console.log(data[country].projects.i);

              var project = data[country].projects.i;

              


              info += "<p>" + project.name + "</p>";
            }
          }
          // info += "<br /><br /><a href='" + data[country].link + "/index_en.htm'>Fisheries partnership agreement</a>";
        }
        else {
          info = country;
        }
        layer.bindPopup( "<p>" + info + "</p>");
      }
    };
    
    countries =[];
    
    for (var k in data) {
      countries.push(k);
    };
    
    var eu_countries = L.wt.countries([{"level":0,"countries":countries}],country_options).addTo(map);
    
    /* MARITIME ZONE
    $wt.jsonp("https://webgate.acceptance.ec.europa.eu/fpfis/webtools/corvela/maps/mare-frid/SFPA_EEZ.geojson", function( json, error ) {
      L.geoJson(json, country_options).addTo(map);
    });
     */
    
    $wt._queue("next"); // process next components
    
  }
};